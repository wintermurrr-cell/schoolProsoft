     1                                  global _start; Объявляем точку входа _start глобальной для линковщика
     2                                  
     3                                  section .data; Секция данных (инициализированные данные)
     4                                  
     5 00000000 456E7465722031206E-     msgNumber1 db "Enter 1 number: ", 0
     5 00000009 756D6265723A2000   
     6                                  msgNumber1_len equ $ - msgNumber1
     7                                  
     8 00000011 456E7465722032206E-     msgNumber2 db "Enter 2 number: ", 0
     8 0000001A 756D6265723A2000   
     9                                  msgNumber2_len equ $ - msgNumber2
    10                                  
    11 00000022 416E737765723A2000      msgResult db "Answer: ", 0
    12                                  msgResult_len equ $ - msgResult
    13                                  
    14 0000002B 616E206572726F7220-     error_msg db "an error occurred while executing the program",10 ; Сообщение которое будем выводить при ошибке "во время выполнения программы произошла ошибка", с переходом на новую строку(10)
    14 00000034 6F6363757272656420-
    14 0000003D 7768696C6520657865-
    14 00000046 637574696E67207468-
    14 0000004F 652070726F6772616D-
    14 00000058 0A                 
    15                                  error_msg_length equ $ - error_msg ; Считаем автоматически длину строки
    16                                  
    17 00000059 0000000000000000        number1 dq 0
    18 00000061 0000000000000000        number2 dq 0
    19 00000069 0000000000000000        answer dq 0
    20                                  
    21                                  section .bss
    22 00000000 <res 20h>               buffer resb 32
    23 00000020 <res 20h>               buffer_answer resb 32
    24                                  
    25                                  section .text ; Секция кода - исполняемая программа
    26                                  _start: ; Точка входа программы
    27                                  
    28 00000000 48BE-                   mov rsi, msgNumber1
    28 00000002 [0000000000000000] 
    29 0000000A BA11000000              mov rdx, msgNumber1_len
    30 0000000F E87A000000              call print_console
    31                                  
    32                                  ; Ввод числа 1    
    33 00000014 E895000000              call read_console
    34                                  
    35 00000019 49B9-                   mov r9, number1
    35 0000001B [5900000000000000] 
    36 00000023 E8A8000000              call str_to_int
    37                                  
    38 00000028 48BE-                   mov rsi, msgNumber2
    38 0000002A [1100000000000000] 
    39 00000032 BA11000000              mov rdx, msgNumber2_len
    40 00000037 E852000000              call print_console
    41                                  
    42                                  ; Ввод числа 2    
    43 0000003C E86D000000              call read_console
    44                                  
    45 00000041 49B9-                   mov r9, number2
    45 00000043 [6100000000000000] 
    46 0000004B E880000000              call str_to_int
    47                                  
    48                                  ; Сложение
    49 00000050 E8D7000000              call sum
    50                                  
    51                                  ; Вывод сообщения ответа
    52 00000055 48BE-                   mov rsi, msgResult
    52 00000057 [2200000000000000] 
    53 0000005F BA09000000              mov rdx, msgResult_len
    54 00000064 E825000000              call print_console
    55                                  
    56 00000069 E88F000000              call int_to_str
    57                                  
    58                                  ; Печать результата
    59 0000006E 48BE-                   mov rsi, buffer_answer
    59 00000070 [2000000000000000] 
    60 00000078 BA20000000              mov rdx, 32
    61 0000007D E80C000000              call print_console
    62                                  
    63 00000082 B83C000000              mov rax, 60
    64 00000087 BF00000000              mov rdi, 0
    65 0000008C 0F05                    syscall
    66                                  
    67                                  print_console:
    68 0000008E B801000000              mov rax, 1
    69 00000093 BF01000000              mov rdi, 1
    70 00000098 0F05                    syscall
    71                                  
    72 0000009A 4883F800                cmp rax, 0      ; Сравниваем возвращаемое значение с 0
    73 0000009E 0F8CA4000000            jl error_end    ; Если отрицательное - ошибка
    74                                  
    75 000000A4 4839D0                  cmp rax, rdx ; Сравниваем с заранее заданной длиной
    76 000000A7 0F8C9B000000            jl error_end ; Если выведено не то кол-во байтов - ошибка
    77                                  
    78 000000AD C3                      ret
    79                                  
    80                                  read_console:
    81 000000AE B800000000              mov rax, 0 ; read (системный вызов)
    82 000000B3 BF00000000              mov rdi, 0 ; Читаем поток stdin
    83 000000B8 48BE-                   mov rsi, buffer ; Считываемый текст в переменную
    83 000000BA [0000000000000000] 
    84 000000C2 BA20000000              mov rdx, 32
    85 000000C7 0F05                    syscall
    86                                  
    87 000000C9 4883F800                cmp rax, 0 ; Сравниваем возвращаемое значение с 0
    88 000000CD 7C79                    jl error_end ; Если отрицательное - ошибка
    89                                  
    90 000000CF C3                      ret
    91                                  
    92                                  str_to_int:
    93 000000D0 48BE-                   mov rsi, buffer
    93 000000D2 [0000000000000000] 
    94 000000DA B800000000              mov rax, 0
    95 000000DF BB0A000000              mov rbx, 10
    96                                  
    97                                  str_to_int_loop:
    98 000000E4 8A0E                    mov cl, [rsi] ; берем текущий символ
    99 000000E6 80F90A                  cmp cl, 10 ; проверяем перенос строки
   100 000000E9 740E                    je str_to_int_done
   101                                  
   102 000000EB 80E930                  sub cl, '0' ; преобразуем символ в цифру
   103 000000EE 48F7E3                  mul rbx ; умножаем текущее число на 10
   104 000000F1 4801C8                  add rax, rcx ; добавляем новую цифру
   105                                  
   106 000000F4 48FFC6                  inc rsi ; переходим к следующему символу
   107 000000F7 EBEB                    jmp str_to_int_loop
   108                                  
   109                                  str_to_int_done:
   110 000000F9 498901                  mov [r9], rax        ; сохраняем результат
   111 000000FC C3                      ret
   112                                  
   113                                  int_to_str:
   114 000000FD 488B0425[69000000]      mov rax, [answer]
   115 00000105 48BF-                   mov rdi, buffer_answer
   115 00000107 [2000000000000000] 
   116 0000010F 4883C71E                add rdi, 30
   117 00000113 BB0A000000              mov rbx, 10 ; основание системы
   118                                  
   119                                  int_to_str_loop:
   120                                  
   121 00000118 48FFCF                  dec rdi ; двигаемся назад по буферу
   122 0000011B 4831D2                  xor rdx, rdx ; обнуляем RDX для деления
   123 0000011E 48F7F3                  div rbx ; делим RAX на 10, остаток в RDX
   124 00000121 80C230                  add dl, '0' ; преобразуем цифру в символ
   125 00000124 8817                    mov [rdi], dl ; сохраняем символ
   126                                  
   127 00000126 4885C0                  test rax, rax ; проверяем, осталось ли число
   128 00000129 75ED                    jnz int_to_str_loop ; если не ноль, продолжаем
   129                                  
   130 0000012B C3                      ret
   131                                  
   132                                  
   133                                  sum:
   134 0000012C 4C8B0C25[59000000]      mov r9, [number1]
   135 00000134 4C8B0425[61000000]      mov r8, [number2]
   136 0000013C 4D01C1                  add r9, r8
   137 0000013F 4C890C25[69000000]      mov [answer], r9
   138 00000147 C3                      ret        
   139                                  
   140                                  ; Секция вывода сообщения об ошибке
   141                                  error_end:
   142                                  
   143 00000148 B801000000              mov rax, 1 ; Системный вызов write (вывод)
   144 0000014D BF02000000              mov rdi, 2 ; Дескриптор файла stderr (стандартный вывод ошибок)
   145 00000152 48BE-                   mov rsi, error_msg ; Адрес сообщения об ошибке
   145 00000154 [2B00000000000000] 
   146 0000015C BA2E000000              mov rdx, error_msg_length ; Длина сообщения об ошибке
   147 00000161 0F05                    syscall ;  Системной вызов вывода об ошибке
   148                                  
   149 00000163 B83C000000              mov rax, 60
   150 00000168 BF01000000              mov rdi, 1
   151 0000016D 0F05                    syscall
